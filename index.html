<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Money Tracking App</title>
    <link rel="icon" type="image/png" href="public/images/logo.png" />
    <link rel="stylesheet" href="public/styles/base.css" />
    <script type="module" src="public/scripts/app.js"></script>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header>
        <img src="public/images/logo.png" alt="Logo" class="logo" />
        <div class="title-warp">
          <h1>Money Tracking App</h1>
          <p>Quản lý chi tiêu hiệu quả</p>
        </div>
        <div class="head-action-warp">
          <button class="head-action-button focus-ring fade" id="btnSettings">
            Cài đặt
          </button>
          <button class="head-action-button focus-ring fade" id="btnLogin">
            Đăng nhập
          </button>
        </div>
      </header>

      <!-- Summary Card -->
      <section class="summaryGrid">
        <div class="summaryCard">
          <p id="lblToday">Hôm nay</p>
          <p id="sumToday">0 VND</p>
        </div>
        <div class="summaryCard">
          <p id="lblTomorrow">Ngày mai</p>
          <p id="sumTomorrow">0 VND</p>
        </div>
        <div class="summaryCard">
          <p id="lblThisWeek">Tuần này</p>
          <p id="sumWeek">0 VND</p>
        </div>
        <div class="summaryCard">
          <p id="lblThisMonth">Tháng này</p>
          <p id="sumMonth">0 VND</p>
        </div>
      </section>

      <!-- Filters & Actions -->
      <section class="filters-actions">
        <div class="search-box">
          <label id="lblSearch" class="lblSearch" for="search">Tìm kiếm</label>
          <input
            type="text"
            id="search"
            class="search-input focus-ring fade"
            placeholder="Ghi chú, khách hàng, nguồn, ..."
          />
        </div>
        <div class="actions">
          <div class="action-item">
            <label id="lblFrom" for="fromDate">Từ ngày</label>
            <input type="date" id="fromDate" class="focus-ring fade" />
          </div>
          <div class="action-item">
            <label id="lblTo" for="toDate">Đến ngày</label>
            <input type="date" id="toDate" class="focus-ring fade" />
          </div>
          <div class="action-item">
            <label id="lblSort" for="sort">Sắp xếp</label>
            <select id="sort" class="focus-ring fade">
              <option id="optNewest" value="newest">Mới nhất</option>
              <option id="optOldest" value="oldest">Cũ nhất</option>
              <option id="optAmountDesc" value="amountDesc">Số tiền ↓</option>
              <option id="optAmountAsc" value="amountAsc">Số tiền ↑</option>
            </select>
          </div>
          <div class="action-item">
            <button id="btnClearFilters" class="action-button focus-ring fade">
              Xoá lọc
            </button>
          </div>
        </div>
      </section>

      <!-- Select & delete bar -->
      <div class="select-delete">
        <span class="lblSelectedCount" id="lblSelectedCount"
          >0 mục đã chọn</span
        >
        <div class="select-delete-button-group">
          <button id="btnSelectAll" class="select-all-button focus-ring fade">
            Chọn tất cả
          </button>
          <button id="btnDeleteSelected" class="delete-button focus-ring fade">
            Xóa đã chọn
          </button>
        </div>
      </div>

      <!-- Entries -->
      <section class="entries" id="entries"></section>

      <!-- Floating Add Button -->
      <button id="fab" title="Add Tip" class="fab focus-ring fade">
        + Thêm tip
      </button>
    </div>

    <!-- Entry dialog -->
    <dialog id="entryDialog">
      <form method="dialog" id="entryForm">
        <div class="dlg-head">
          <h2 id="dialogTitle" class="dlg-title">Thêm tip</h2>
          <p class="dlg-sub">
            Quy tắc ngày:
            <span id="logicDesc" style="font-weight: 600"
              >Ghi cho ngày mai</span
            >
          </p>
        </div>

        <div class="dlg-body">
          <input type="hidden" id="entryId" />

          <!-- Số tiền -->
          <div class="field">
            <label id="lblAmount" class="flabel" for="amount"
              >Số tiền (VND)</label
            >
            <div class="amount">
              <input
                id="amount"
                inputmode="numeric"
                placeholder="0"
                class="amount-prefix focus-ring fade"
              />
            </div>
            <div class="quick-buttons">
              <button
                type="button"
                data-quick="5000"
                class="quick focus-ring fade"
              >
                +5k
              </button>
              <button
                type="button"
                data-quick="10000"
                class="quick focus-ring fade"
              >
                +10k
              </button>
              <button
                type="button"
                data-quick="20000"
                class="quick focus-ring fade"
              >
                +20k
              </button>
              <button
                type="button"
                data-quick="50000"
                class="quick focus-ring fade"
              >
                +50k
              </button>
              <button
                type="button"
                data-quick="100000"
                class="quick focus-ring fade"
              >
                +100k
              </button>
              <button
                type="button"
                data-quick="200000"
                class="quick focus-ring fade"
              >
                +200k
              </button>
              <button
                type="button"
                data-quick="-5000"
                class="quick focus-ring fade"
              >
                -5k
              </button>
              <button
                type="button"
                data-quick="-10000"
                class="quick focus-ring fade"
              >
                -10k
              </button>
            </div>
          </div>

          <!-- Ngày nhập + ngày tính -->
          <div class="field">
            <label id="lblInputDate" class="flabel" for="inputDate"
              >Ngày nhập (hôm nay)</label
            >
            <input
              id="inputDate"
              type="date"
              class="inputDate focus-ring fade"
            />
            <div class="record">
              <label class="pill">
                <input
                  id="recordTomorrow"
                  type="checkbox"
                  style="width: 16px; height: 16px"
                />
                <span id="lblRecordTomorrow" style="font-size: 14px"
                  >Ghi cho ngày mai (mặc định)</span
                >
              </label>
              <div class="muted">
                <span id="lblIntendedLabel">Ngày tính:</span>
                <span id="intendedPreview">—</span>
              </div>
            </div>

            <div class="field">
              <label id="lblOverride" class="flabel" for="intendedDate"
                >Chỉnh ngày tính (tuỳ chọn)</label
              >
              <input
                id="intendedDate"
                type="date"
                class="intendedDate focus-ring fade"
              />
              <p id="lblOverrideDesc" class="muted">
                Mặc định: ngày tính = ngày nhập + 1 khi bật "Ghi cho ngày mai".
              </p>
            </div>
          </div>

          <!-- Nguồn khách hàng (select từ Settings) -->
          <div class="field">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <label class="flabel" for="sourceSelect">Nguồn khách hàng</label>
              <!-- <span class="link" id="lnkManageSettings1">Quản lý danh mục</span> -->
            </div>
            <select
              id="sourceSelect"
              class="sourceSelect focus-ring fade"
            ></select>
          </div>

          <!-- Nơi lưu trữ tiền (select từ Settings) -->
          <div class="field">
            <label class="flabel" for="storageSelect">Nơi lưu trữ tiền</label>
            <select
              id="storageSelect"
              class="storageSelect focus-ring fade"
            ></select>
          </div>

          <!-- Ngân hàng (select từ Settings, chỉ hiện khi storage = transfer) -->
          <div class="field" id="bankWrap" style="display: none">
            <label class="flabel" for="bankSelect">Ngân hàng</label>
            <select id="bankSelect" class="focus-ring fade"></select>
          </div>

          <!-- Khách hàng -->
          <div class="field">
            <label id="lblClient" class="flabel" for="client">Khách hàng</label>
            <input
              id="client"
              placeholder="Tên khách (tuỳ chọn)"
              class="client-input focus-ring fade"
            />
          </div>

          <!-- Ghi chú -->
          <div class="field">
            <label id="lblNote" class="flabel" for="note">Ghi chú</label>
            <input
              id="note"
              placeholder="Khách / ca / ghi chú…"
              class="note-input focus-ring fade"
            />
          </div>
        </div>

        <div class="dlg-foot">
          <button
            id="btnCancel"
            type="button"
            class="btnCancel focus-ring fade"
          >
            Hủy
          </button>
          <button id="btnSave" value="default" class="btnSave focus-ring fade">
            Lưu
          </button>
        </div>
      </form>
    </dialog>

    <!-- Settings Hub (mở từ nút Cài đặt trên header) -->
    <dialog id="settingsHubDialog">
      <form method="dialog" id="settingsHubForm">
        <div class="dlg-head">
          <h2 class="dlg-title">Cài đặt</h2>
        </div>

        <div class="dlg-body">
          <button
            type="button"
            id="btnOpenCategoryManager"
            class="setting-button focus-ring fade"
            style="width: 100%"
          >
            Quản lý danh mục
          </button>
        </div>

        <div class="dlg-foot">
          <button
            id="btnCloseSettingsHub"
            type="button"
            class="btnCancel focus-ring fade"
          >
            Đóng
          </button>
        </div>
      </form>
    </dialog>

    <!-- Category Management -->
    <dialog id="categoryManagerDialog">
      <form method="dialog" id="categoryManagerForm">
        <div class="dlg-head">
          <h2 class="dlg-title">Quản lý danh mục</h2>
          <p class="dlg-sub">
            Thêm, xoá, đặt mặc định cho Nguồn/Lưu trữ/Ngân hàng
          </p>
        </div>

        <div class="dlg-body settings-grid">
          <!-- Nguồn khách hàng -->
          <div class="card">
            <h3>Nguồn khách hàng</h3>
            <div class="sourcesList" id="sourcesList"></div>
            <div class="inline-form">
              <input
                class="inpNewSource focus-ring fade"
                id="inpNewSource"
                placeholder="Thêm nguồn mới…"
              />
              <button
                type="button"
                id="btnAddSource"
                class="btnAddSource focus-ring fade"
              >
                Thêm
              </button>
            </div>
            <div class="inline-form">
              <label class="muted" for="selDefaultSource">Mặc định</label>
              <select class="selDefaultSource focus-ring fade" id="selDefaultSource"></select>
            </div>
          </div>

          <!-- Nơi lưu trữ tiền -->
          <div class="card">
            <h3>Nơi lưu trữ tiền</h3>
            <div id="storagesList"></div>
            <div class="inline-form">
              <input
                class="inpNewStorageName focus-ring fade"
                id="inpNewStorageName"
                placeholder="Tên nơi lưu trữ (VD: Tiền mặt, Chuyển khoản…)"
              />
              <select class="selNewStorageKind focus-ring fade" id="selNewStorageKind">
                <option value="cash">Tiền mặt</option>
                <option value="transfer">Chuyển khoản (cần ngân hàng)</option>
              </select>
              <button
                type="button"
                id="btnAddStorage"
                class="btnAddStorage focus-ring fade"
              >
                Thêm
              </button>
            </div>
            <div class="inline-form">
              <label
                class="muted-sm"
                for="selDefaultStorage"
                style="min-width: 120px"
                >Mặc định</label
              >
              <select class="selDefaultStorage focus-ring fade" id="selDefaultStorage"></select>
            </div>
          </div>

          <!-- Ngân hàng -->
          <div class="card">
            <h3>Ngân hàng</h3>
            <div id="banksList"></div>
            <div class="inline-form">
              <input
                class="inpNewBank focus-ring fade"
                id="inpNewBank"
                placeholder="Tên ngân hàng (VCB, TCB, ACB…)"
              />
              <button
                type="button"
                id="btnAddBank"
                class="btnAddBank focus-ring fade"
              >
                Thêm
              </button>
            </div>
            <div class="inline-form">
              <label
                class="muted-sm"
                for="selDefaultBank"
                style="min-width: 120px"
                >Mặc định</label
              >
              <select class="selDefaultBank focus-ring fade" id="selDefaultBank"></select>
            </div>
            <p class="muted-sm">
              * Chỉ áp dụng khi nơi lưu trữ là “Chuyển khoản”.
            </p>
          </div>
        </div>

        <div class="settings-footer">
          <button
            id="btnCloseSettings"
            type="button"
            class="btnCancel focus-ring fade"
          >
            Đóng
          </button>
        </div>
      </form>
    </dialog>
  </body>
</html>
